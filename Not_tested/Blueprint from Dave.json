{"status":{},"contains_secrets":false,"product_version":"2.9.7","spec":{"description":"This blueprint deploys a sample application that when pushed to the git repository is built, tested and deployed onto VMs where it can be accessed by the developer or tester to validate functionality. The MongoDB instance is micro-segmented via Flow and is only accessible from the NodeJS service that is deployed within the same deployment. All of the services are registered with Epoch.","resources":{"client_attrs":{"f8416720_deployment":{"y":313,"x":744.75},"02eb0f42_deployment":{"y":607,"x":1194.75},"None":{"y":157,"x":515.75},"c4a7ebbf_deployment":{"y":460,"x":965.75},"NodeJS":{"y":420,"x":940},"5854d6fd_deployment":{"y":159,"x":524.5},"MongoDB":{"y":200,"x":660},"Nginx":{"y":640,"x":1240}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MongoDB"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"1e24c412_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"9973e402_runbook","main_task_local_reference":{"kind":"app_task","name":"1e24c412_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MongoDB"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"208e0c06_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"9b9b7baa_runbook","main_task_local_reference":{"kind":"app_task","name":"208e0c06_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MongoDB"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Mongodb Deployment Category Update"}],"name":"9a1df277_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MongoDB"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Mongodb Deployment Category Update","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"edfbbe8b_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"fee50ad4_runbook","main_task_local_reference":{"kind":"app_task","name":"9a1df277_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MongoDB"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"191f8ebb_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"aa2452ba_runbook","main_task_local_reference":{"kind":"app_task","name":"191f8ebb_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MongoDB"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"6a3ec2fa_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"29e96d1d_runbook","main_task_local_reference":{"kind":"app_task","name":"6a3ec2fa_dag"},"variable_list":[]},"name":"action_restart"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Load Data"}],"name":"09a00c23_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MongoDB"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Load Data","attrs":{"exit_status":[],"script":"# Stay out of home dir as some issues arise with SSH Key auth if tar file is unpacked incorrectly.\ncd \/tmp\/\n\necho \"Download MongoDB insert script\"\nsudo wget --user admin --password password -O \/tmp\/db.tar.gz  http:\/\/@@{artifactory_ip}@@:8081\/artifactory\/@@{project_name}@@-local-repo\/@@{project_name}@@@@{build_number}@@\/db.tar.gz \ncd \/tmp\/\n\necho \"Unpack MongoDB insert script\"\nsudo tar xvfz \/tmp\/db.tar.gz -C \/tmp\/\n\necho \"Load MongoDB data\"\nmongo demodb < \/tmp\/collections.json\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"ef6b3a3e_runbook","main_task_local_reference":{"kind":"app_task","name":"09a00c23_dag"},"variable_list":[]},"name":"MongoDB Load"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install MongoDB"}],"name":"d6bf3393_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MongoDB"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install MongoDB","attrs":{"exit_status":[],"script":"echo \"Updating MongoDB Repositories\"\necho '[mongodb-org-3.4]\nname=MongoDB Repository\nbaseurl=https:\/\/repo.mongodb.org\/yum\/redhat\/$releasever\/mongodb-org\/3.4\/x86_64\/\ngpgcheck=1\nenabled=1\ngpgkey=https:\/\/www.mongodb.org\/static\/pgp\/server-3.4.asc' | sudo tee \/etc\/yum.repos.d\/mongodb-org.repo\n\necho \"Output repository list\"\nsudo yum repolist\n\necho \"Install MongoDB\"\nsudo yum install -y mongodb-org\n\necho \"Update mongod.conf to allow connections from anywhere\"\nsudo sed -i 's\/bindIp: 127.0.0.1\/bindIp: 0.0.0.0\/g' \/etc\/mongod.conf \n\necho \"Enable MongoDB Service\"\nsudo systemctl enable mongod\n\necho \"Start MongoDB Service\"\nsudo systemctl restart mongod\n\necho \"Configure firewall\"\nsudo firewall-cmd --permanent --zone=public --add-port=27017\/tcp\nsudo firewall-cmd --permanent --add-service='ssh'\nsudo firewall-cmd --reload\n\necho \"Install wget\"\nsudo yum install -y wget\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"5d61bb96_runbook","main_task_local_reference":{"kind":"app_task","name":"d6bf3393_dag"},"variable_list":[]},"name":"MongoDB Installation"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Add Category Value to VM"}],"name":"65184505_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MongoDB"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Add Category Value to VM","attrs":{"script":"user = \"@@{Prism Central User.username}@@\"\npassword = \"@@{Prism Central User.secret}@@\"\n\ndef process_request(url, method, user, password, headers, payload=None):\n  r = urlreq(url, verb=method, auth=\"BASIC\", user=user, passwd=password, params=payload, verify=False, headers=headers)\n  return r\n\npayload = {\"length\":500}\n\nbase_url = \"https:\/\/@@{pc_instance_ip}@@:9440\/api\/nutanix\/v3\/vms\"\nurl = base_url + \"\/list\"\nheaders = {'Accept': 'application\/json', 'Content-Type': 'application\/json'}\nurl_method = \"POST\"\n\nr = process_request(url, url_method, user, password, headers, json.dumps(payload))\nprint \"Response Status: \" + str(r.status_code)\nvm_list_json = r.json()\nfor vm in vm_list_json['entities']:\n  if (vm['spec']['name'] == \"@@{name}@@\"):\n    vm_json = vm\n\ndel vm_json['status']\nvm_json['metadata']['categories']['Deployment'] = \"@@{calm_application_name}@@\"\nprint \"Categories: \" + json.dumps(vm_json['metadata']['categories'])\nprint \"VM JSON: \" + json.dumps(vm_json)\n\nurl = base_url + \"\/\" + str(vm_json['metadata']['uuid'])\nurl_method = \"PUT\"\nr = process_request(url, url_method, user, password, headers, json.dumps(vm_json))\nprint \"Response Status: \" + str(r.status_code)\nprint \"Response: \", r.json()","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"edfbbe8b_runbook","main_task_local_reference":{"kind":"app_task","name":"65184505_dag"},"variable_list":[]},"name":"Mongodb Deployment Category Update"}],"depends_on_list":[{"kind":"app_service","name":"Flow"}],"name":"MongoDB","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"NodeJS"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"NodeJS Configuration"}],"name":"bef1e0ff_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"NodeJS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"NodeJS Configuration","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"8b136b3d_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"9ce2bb44_runbook","main_task_local_reference":{"kind":"app_task","name":"bef1e0ff_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"NodeJS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"b21de10f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"facec687_runbook","main_task_local_reference":{"kind":"app_task","name":"b21de10f_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"NodeJS"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Nodejs Deployment Category Update"}],"name":"21769bcf_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"NodeJS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Nodejs Deployment Category Update","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"8c025ba3_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"607577d2_runbook","main_task_local_reference":{"kind":"app_task","name":"21769bcf_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"NodeJS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"62ddf398_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"ef5f81d2_runbook","main_task_local_reference":{"kind":"app_task","name":"62ddf398_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"NodeJS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"83048315_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"c004209e_runbook","main_task_local_reference":{"kind":"app_task","name":"83048315_dag"},"variable_list":[]},"name":"action_restart"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Configure NodeJS"}],"name":"b38e7868_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"NodeJS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure NodeJS","attrs":{"exit_status":[],"script":"sudo mkdir -p \/var\/www\/html\/\n\necho '#!\/bin\/bash\nexport MONGODB_HOST='@@{MongoDB.address}@@'\n\/usr\/bin\/node \/var\/www\/html\/app.js' | sudo tee \/var\/www\/html\/runnode.sh\n\nsudo chmod 700 \/var\/www\/html\/runnode.sh\n\necho '[Unit]\nDescription=NodeJs app\n\n[Service]\nExecStart=\/var\/www\/html\/runnode.sh\nRestart=always\nUser=root\nGroup=root\nEnvironment=PATH=\/usr\/bin:\/usr\/local\/bin\nEnvironment=NODE_ENV=production\nWorkingDirectory=\/var\/www\/html\n\n[Install]\nWantedBy=multi-user.target' | sudo tee \/etc\/systemd\/system\/nodejsapp.service\n\ncd \/var\/www\/html\/\nsudo wget --user admin --password password -O \/var\/www\/html\/nodejs-app.tar.gz http:\/\/@@{artifactory_ip}@@:8081\/artifactory\/@@{project_name}@@-local-repo\/@@{project_name}@@@@{build_number}@@\/nodejs-app.tar.gz\nsudo tar xvfz \/var\/www\/html\/nodejs-app.tar.gz\n\nsudo systemctl start nodejsapp\nsudo systemctl enable nodejsapp\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"8b136b3d_runbook","main_task_local_reference":{"kind":"app_task","name":"b38e7868_dag"},"variable_list":[]},"name":"NodeJS Configuration"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install NodeJS"}],"name":"350f4067_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"NodeJS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install NodeJS","attrs":{"exit_status":[],"script":"echo \"Install Epel Repositories\"\nsudo yum install -y epel-release\n\necho \"Install Node.js\"\nsudo yum install -y nodejs\n\necho \"Check Version\"\nnode -v\n\necho \"Configure firewall\"\nsudo firewall-cmd --permanent --zone=public --add-port=3000\/tcp\nsudo firewall-cmd --permanent --add-service='ssh'\nsudo firewall-cmd --reload\n\nsudo yum install -y wget","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"2462adfe_runbook","main_task_local_reference":{"kind":"app_task","name":"350f4067_dag"},"variable_list":[]},"name":"NodeJS Installation"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install NPM"}],"name":"55f3b084_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"NodeJS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install NPM","attrs":{"exit_status":[],"script":"echo \"Install NPM\"\nsudo yum install -y npm\n\necho \"Check NPM Version\"\nnpm -v","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"ace70036_runbook","main_task_local_reference":{"kind":"app_task","name":"55f3b084_dag"},"variable_list":[]},"name":"NPM Installation"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Add Category Value to VM"},{"kind":"app_task","name":"Restart NodeJS"}],"name":"587ae2b2_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Add Category Value to VM"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Restart NodeJS"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"NodeJS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Add Category Value to VM","attrs":{"script":"user = \"@@{Prism Central User.username}@@\"\npassword = \"@@{Prism Central User.secret}@@\"\n\ndef process_request(url, method, user, password, headers, payload=None):\n  r = urlreq(url, verb=method, auth=\"BASIC\", user=user, passwd=password, params=payload, verify=False, headers=headers)\n  return r\n\npayload = {\"length\":500}\n\nbase_url = \"https:\/\/@@{pc_instance_ip}@@:9440\/api\/nutanix\/v3\/vms\"\nurl = base_url + \"\/list\"\nheaders = {'Accept': 'application\/json', 'Content-Type': 'application\/json'}\nurl_method = \"POST\"\n\nr = process_request(url, url_method, user, password, headers, json.dumps(payload))\nprint \"Response Status: \" + str(r.status_code)\nvm_list_json = r.json()\nfor vm in vm_list_json['entities']:\n  if (vm['spec']['name'] == \"@@{name}@@\"):\n    vm_json = vm\n\ndel vm_json['status']\nvm_json['metadata']['categories']['Deployment'] = \"@@{calm_application_name}@@\"\nprint \"Categories: \" + json.dumps(vm_json['metadata']['categories'])\nprint \"VM JSON: \" + json.dumps(vm_json)\n\nurl = base_url + \"\/\" + str(vm_json['metadata']['uuid'])\nurl_method = \"PUT\"\nr = process_request(url, url_method, user, password, headers, json.dumps(vm_json))\nprint \"Response Status: \" + str(r.status_code)\nprint \"Response: \", r.json()","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"NodeJS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart NodeJS","attrs":{"exit_status":[],"script":"echo \"Restart Node.js\"\nsudo systemctl restart nodejsapp\n\n#echo \"Check Status of Node.js\"\n#sudo systemctl status nodejsapp\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"8c025ba3_runbook","main_task_local_reference":{"kind":"app_task","name":"587ae2b2_dag"},"variable_list":[]},"name":"Nodejs Deployment Category Update"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Nodejs Install Mongo"}],"name":"464f8e38_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"NodeJS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Nodejs Install Mongo","attrs":{"exit_status":[],"script":"echo \"Updating MongoDB Repositories\"\necho '[mongodb-org-3.4]\nname=MongoDB Repository\nbaseurl=https:\/\/repo.mongodb.org\/yum\/redhat\/$releasever\/mongodb-org\/3.4\/x86_64\/\ngpgcheck=1\nenabled=1\ngpgkey=https:\/\/www.mongodb.org\/static\/pgp\/server-3.4.asc' | sudo tee \/etc\/yum.repos.d\/mongodb-org.repo\n\necho \"Output repository list\"\nsudo yum repolist\n\necho \"Install MongoDB\"\nsudo yum install -y mongodb-org\n\necho \"Enable MongoDB Service\"\nsudo systemctl disable mongod\n\necho \"Start MongoDB Service\"\nsudo systemctl stop mongod\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"301fcf68_runbook","main_task_local_reference":{"kind":"app_task","name":"464f8e38_dag"},"variable_list":[]},"name":"Nodejs Mongo Install for Testing"}],"depends_on_list":[{"kind":"app_service","name":"MongoDB"}],"name":"NodeJS","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Nginx"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Nginx Configuration"}],"name":"43c09141_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Nginx"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Nginx Configuration","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"0f4c6180_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"a0af322b_runbook","main_task_local_reference":{"kind":"app_task","name":"43c09141_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Nginx"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"0c1509c6_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"09067909_runbook","main_task_local_reference":{"kind":"app_task","name":"0c1509c6_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Nginx"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"a807ccbf_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"8a33aaec_runbook","main_task_local_reference":{"kind":"app_task","name":"a807ccbf_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Nginx"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"dbf714ad_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"3a6afede_runbook","main_task_local_reference":{"kind":"app_task","name":"dbf714ad_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Nginx"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"064c4dc5_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"87aa8d05_runbook","main_task_local_reference":{"kind":"app_task","name":"064c4dc5_dag"},"variable_list":[]},"name":"action_restart"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install Nginx"}],"name":"5c719c23_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Nginx"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Nginx","attrs":{"exit_status":[],"script":"sudo yum install -y epel-release\nsudo yum install -y nginx\n\nsudo systemctl start nginx\n\nsudo firewall-cmd --permanent --zone=public --add-service=http \nsudo firewall-cmd --permanent --zone=public --add-service=https\nsudo firewall-cmd --reload\n\nsudo yum install -y wget","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"ea95f24d_runbook","main_task_local_reference":{"kind":"app_task","name":"5c719c23_dag"},"variable_list":[]},"name":"Nginx Installation"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Configure Nginx"}],"name":"490b0157_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Nginx"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure Nginx","attrs":{"exit_status":[],"script":"cd \/usr\/share\/nginx\/html\nsudo rm *\nsudo wget --user admin --password password http:\/\/@@{artifactory_ip}@@:8081\/artifactory\/@@{project_name}@@-local-repo\/@@{project_name}@@@@{build_number}@@\/web.tar.gz\nsudo tar xvfz web.tar.gz\nsleep 2\n\nsudo sed -i 's\/NODEJS_IP_ADDRESS\/@@{NodeJS.address}@@\/' \/usr\/share\/nginx\/html\/js\/data.js\nsudo sed -i 's\/WEB_IP_ADDRESS\/'`\/usr\/sbin\/ip address show dev eth0 | grep \"inet\" | grep -v \"inet6\" | cut -d '\/' -f1 | cut -d ' ' -f6`'\/' \/usr\/share\/nginx\/html\/index.html\nsudo sed -i 's\/WEB_SERVER_NAME\/'`hostname`'\/' \/usr\/share\/nginx\/html\/index.html\n\nsudo chmod 644 index.html\nsudo chmod 755 css\/\nsudo chmod 755 js\/\nsudo chmod 755 images\/\nsudo chmod 644 css\/*\nsudo chmod 644 js\/*\nsudo chmod 644 images\/*","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"0f4c6180_runbook","main_task_local_reference":{"kind":"app_task","name":"490b0157_dag"},"variable_list":[]},"name":"Nginx Configuration"}],"depends_on_list":[{"kind":"app_service","name":"NodeJS"}],"name":"Nginx","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Flow"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"dc2e8edc_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"51901a0a_runbook","main_task_local_reference":{"kind":"app_task","name":"dc2e8edc_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Flow"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"4986ead2_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"17f01764_runbook","main_task_local_reference":{"kind":"app_task","name":"4986ead2_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Flow"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"9bb13040_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"1ed73430_runbook","main_task_local_reference":{"kind":"app_task","name":"9bb13040_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Flow"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ebc9651a_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"3c75d543_runbook","main_task_local_reference":{"kind":"app_task","name":"ebc9651a_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Flow"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"b5af616e_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"c618162c_runbook","main_task_local_reference":{"kind":"app_task","name":"b5af616e_dag"},"variable_list":[]},"name":"action_restart"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Create Deployment Category"},{"kind":"app_task","name":"Update Deployment"},{"kind":"app_task","name":"Create AppType Mongo_Deployment"}],"name":"6ae35cb9_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Create Deployment Category"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Update Deployment"}},{"from_task_reference":{"kind":"app_task","name":"Update Deployment"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Create AppType Mongo_Deployment"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Flow"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Create Deployment Category","attrs":{"script":"user = \"@@{Prism Central User.username}@@\"\npassword = \"@@{Prism Central User.secret}@@\"\n\ndef process_request(url, method, user, password, headers, payload=None):\n    r = urlreq(url, verb=method, auth=\"BASIC\", user=user, passwd=password, params=payload, verify=False, headers=headers)\n    return r\n\nurl = \"https:\/\/@@{pc_instance_ip}@@:9440\/api\/nutanix\/v3\/categories\/Deployment\"\nheaders = {'Accept': 'application\/json', 'Content-Type': 'application\/json'}\nurl_method = \"PUT\"\npayload = {\"name\": \"Deployment\",\"description\":\"Deployment\"}\nr = process_request(url, url_method, user, password, headers, json.dumps(payload))\nprint \"Response Status: \" + str(r.status_code)\nprint \"Response: \", r.json()\n\n","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Flow"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Update Deployment","attrs":{"script":"user = \"@@{Prism Central User.username}@@\"\npassword = \"@@{Prism Central User.secret}@@\"\n\ndef process_request(url, method, user, password, headers, payload=None):\n    r = urlreq(url, verb=method, auth=\"BASIC\", user=user, passwd=password, params=payload, verify=False, headers=headers)\n    return r\n\nurl = \"https:\/\/@@{pc_instance_ip}@@:9440\/api\/nutanix\/v3\/categories\/Deployment\/@@{calm_application_name}@@\"\nheaders = {'Accept': 'application\/json', 'Content-Type': 'application\/json'}\nurl_method = \"PUT\"\npayload = {\"value\": \"@@{calm_application_name}@@\",\"description\":\"@@{calm_application_name}@@ deployment\"}\nr = process_request(url, url_method, user, password, headers, json.dumps(payload))\nprint \"Response Status: \" + str(r.status_code)\nprint \"Response: \", r.json()\n\n","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Flow"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Create AppType Mongo_Deployment","attrs":{"script":"user = \"@@{Prism Central User.username}@@\"\npassword = \"@@{Prism Central User.secret}@@\"\n\ndef process_request(url, method, user, password, headers, payload=None):\n    r = urlreq(url, verb=method, auth=\"BASIC\", user=user, passwd=password, params=payload, verify=False, headers=headers)\n    return r\n\nurl = \"https:\/\/@@{pc_instance_ip}@@:9440\/api\/nutanix\/v3\/categories\/AppType\/Mongo_Deployment\"\nheaders = {'Accept': 'application\/json', 'Content-Type': 'application\/json'}\nurl_method = \"PUT\"\npayload = {\"value\": \"Mongo_Deployment\",\"description\":\"Mongo_Deployment deployment\"}\nr = process_request(url, url_method, user, password, headers, json.dumps(payload))\nprint \"Response Status: \" + str(r.status_code)\nprint \"Response: \", r.json()\n\nurl = \"https:\/\/@@{pc_instance_ip}@@:9440\/api\/nutanix\/v3\/categories\/AppType\/Node.js_Deployment\"\nheaders = {'Accept': 'application\/json', 'Content-Type': 'application\/json'}\nurl_method = \"PUT\"\npayload = {\"value\": \"Node.js_Deployment\",\"description\":\"Node.js_Deployment deployment\"}\nr = process_request(url, url_method, user, password, headers, json.dumps(payload))\nprint \"Response Status: \" + str(r.status_code)\nprint \"Response: \", r.json()\n","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"98251ac5_runbook","main_task_local_reference":{"kind":"app_task","name":"6ae35cb9_dag"},"variable_list":[]},"name":"Create Category"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Delete Deployment Value"}],"name":"6ae35cb9_dag_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Flow"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Delete Deployment Value","attrs":{"script":"user = \"@@{Prism Central User.username}@@\"\npassword = \"@@{Prism Central User.secret}@@\"\n\ndef process_request(url, method, user, password, headers, payload=None):\n    r = urlreq(url, verb=method, auth=\"BASIC\", user=user, passwd=password, params=payload, verify=False, headers=headers)\n    return r\n\nurl = \"https:\/\/@@{pc_instance_ip}@@:9440\/api\/nutanix\/v3\/categories\/Deployment\/@@{calm_application_name}@@\"\nheaders = {'Accept': 'application\/json', 'Content-Type': 'application\/json'}\nurl_method = \"DELETE\"\nr = process_request(url, url_method, user, password, headers)\nprint \"Response Status: \" + str(r.status_code)\n","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"98251ac5_runbook_cloned_0","main_task_local_reference":{"kind":"app_task","name":"6ae35cb9_dag_cloned_1"},"variable_list":[]},"name":"Delete Category"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Create Policy"}],"name":"9281782f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Flow"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Create Policy","attrs":{"exit_status":[],"script":"user = \"@@{Prism Central User.username}@@\"\npassword = \"@@{Prism Central User.secret}@@\"\n\ndef process_request(url, method, user, password, headers, payload=None):\n    r = urlreq(url, verb=method, auth=\"BASIC\", user=user, passwd=password, params=payload, verify=False, headers=headers)\n    return r\n\nurl = \"https:\/\/@@{pc_instance_ip}@@:9440\/api\/nutanix\/v3\/network_security_rules\"\nheaders = {'Accept': 'application\/json', 'Content-Type': 'application\/json'}\nurl_method = \"POST\"\n\npayload = {\n    \"metadata\": {\n        \"categories\": {},\n        \"kind\": \"network_security_rule\",\n        \"spec_version\": 0\n    },\n    \"spec\": {\n        \"description\": \"Secure mongo @@{calm_application_name}@@ deployment\",\n        \"name\": \"@@{calm_application_name}@@_Policy\",\n        \"resources\": {\n            \"app_rule\": {\n                \"action\": \"APPLY\",\n                \"inbound_allow_list\": [\n                    {\n                        \"filter\": {\n                            \"kind_list\": [\n                                \"vm\"\n                            ],\n                            \"params\": {\n                                \"AppType\": [\n                                    \"Node.js_Deployment\"\n                                ],\n                                \"Deployment\": [\n                                    \"@@{calm_application_name}@@\"\n                                ]\n                            },\n                            \"type\": \"CATEGORIES_MATCH_ALL\"\n                        },\n                        \"peer_specification_type\": \"FILTER\",\n                        \"protocol\": \"TCP\",\n                        \"tcp_port_range_list\": [\n                            {\n                                \"end_port\": 27017,\n                                \"start_port\": 27017\n                            }\n                        ]\n                    },\n                    {\n                        \"ip_subnet\": {\n                            \"ip\": \"10.1.176.99\",\n                            \"prefix_length\": 32\n                        },\n                        \"peer_specification_type\": \"IP_SUBNET\",\n                        \"protocol\": \"TCP\",\n                        \"tcp_port_range_list\": [\n                            {\n                                \"end_port\": 22,\n                                \"start_port\": 22\n                            },\n                            {\n                                \"end_port\": 23,\n                                \"start_port\": 23\n                            }\n                        ]\n                    },\n                    {\n                        \"icmp_type_code_list\": [\n                            {\n                                \"code\": 0,\n                                \"type\": 8\n                            }\n                        ],\n                        \"ip_subnet\": {\n                            \"ip\": \"10.1.176.99\",\n                            \"prefix_length\": 32\n                        },\n                        \"peer_specification_type\": \"IP_SUBNET\",\n                        \"protocol\": \"ICMP\"\n                    }\n                ],\n                \"outbound_allow_list\": [\n                    {\n                        \"peer_specification_type\": \"ALL\"\n                    }\n                ],\n                \"target_group\": {\n                    \"filter\": {\n                        \"kind_list\": [\n                            \"vm\"\n                        ],\n                        \"params\": {\n                            \"AppType\": [\n                                \"Mongo_Deployment\"\n                            ],\n                            \"Deployment\": [\n                                \"@@{calm_application_name}@@\"\n                            ]\n                        },\n                        \"type\": \"CATEGORIES_MATCH_ALL\"\n                    },\n                    \"peer_specification_type\": \"FILTER\"\n                }\n            }\n        }\n    }\n}\n\nprint \"Payload: \" + json.dumps(payload)\n\nr = process_request(url, url_method, user, password, headers, json.dumps(payload))\nprint \"Response Status: \" + str(r.status_code)\nprint \"Response: \", r.json()\n\nprint \"policy_uuid=\", r.json()['metadata']['uuid']\n","eval_variables":["policy_uuid"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]}],"description":"","name":"9d1d6d3d_runbook","main_task_local_reference":{"kind":"app_task","name":"9281782f_dag"},"variable_list":[]},"name":"Create Policy"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Delete Policy"}],"name":"6ae35cb9_dag_cloned_1_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Flow"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Delete Policy","attrs":{"script":"user = \"@@{Prism Central User.username}@@\"\npassword = \"@@{Prism Central User.secret}@@\"\n\ndef process_request(url, method, user, password, headers, payload=None):\n    r = urlreq(url, verb=method, auth=\"BASIC\", user=user, passwd=password, params=payload, verify=False, headers=headers)\n    return r\n\nurl = \"https:\/\/@@{pc_instance_ip}@@:9440\/api\/nutanix\/v3\/network_security_rules\/@@{policy_uuid}@@\"\nheaders = {'Accept': 'application\/json', 'Content-Type': 'application\/json'}\nurl_method = \"DELETE\"\nr = process_request(url, url_method, user, password, headers)\nprint \"Response Status: \" + str(r.status_code)\n","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"98251ac5_runbook_cloned_0_cloned_0","main_task_local_reference":{"kind":"app_task","name":"6ae35cb9_dag_cloned_1_cloned_1"},"variable_list":[]},"name":"Delete Policy"}],"depends_on_list":[],"name":"Flow","port_list":[],"tier":"","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"policy_uuid","value":"","label":"","attrs":{"type":""},"is_hidden":false}],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AHV_VM","name":"MongoDBVM","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"0","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"mongodb-vm-@@{calm_random}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"39e04fe9-f004-4143-82a6-e7ba4caf5597"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":1024,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\n#\nusers:\n  - default\n  - name: @@{Nutanix.username}@@\n    shell: \/bin\/bash\n    homedir: \/home\/@@{Nutanix.username}@@\n    ssh-authorized-keys:\n      - @@{nutanix_public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\n\nssh_pwauth: yes\nfqdn: @@{name}@@.@@{domain_name}@@\nmanage_etc_hosts: true\nhostname: @@{name}@@"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"192944ef-45cd-4a25-8ece-7a1b126310ba","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"centos7_generic","uuid":"dec79ed0-f285-4a26-8114-4242bc2a9c1a"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":{"AppFamily":"Databases","Environment":"Dev","AppType":"Mongo_Deployment"}},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"NodeJSVM","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"0","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"nodejs-vm-@@{calm_random}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"39e04fe9-f004-4143-82a6-e7ba4caf5597"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":1024,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\n#\nusers:\n  - default\n  - name: @@{Nutanix.username}@@\n    shell: \/bin\/bash\n    homedir: \/home\/@@{Nutanix.username}@@\n    ssh-authorized-keys:\n      - @@{nutanix_public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\n\nssh_pwauth: yes\nfqdn: @@{name}@@.@@{domain_name}@@\nmanage_etc_hosts: true\nhostname: @@{name}@@\n"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"192944ef-45cd-4a25-8ece-7a1b126310ba","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"centos7_generic","uuid":"dec79ed0-f285-4a26-8114-4242bc2a9c1a"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":{"AppFamily":"App-Servers","Environment":"Dev","AppType":"Node.js_Deployment"}},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"NginxVM","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"0","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"Nutanix"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"nginx-vm-@@{calm_random}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"39e04fe9-f004-4143-82a6-e7ba4caf5597"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":1024,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\n#\nusers:\n  - default\n  - name: @@{Nutanix.username}@@\n    shell: \/bin\/bash\n    homedir: \/home\/@@{Nutanix.username}@@\n    ssh-authorized-keys:\n      - @@{nutanix_public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\n\nssh_pwauth: yes\nfqdn: @@{name}@@.@@{domain_name}@@\nmanage_etc_hosts: true\nhostname: @@{name}@@\n"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"192944ef-45cd-4a25-8ece-7a1b126310ba","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"centos7_generic","uuid":"dec79ed0-f285-4a26-8114-4242bc2a9c1a"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":{"AppFamily":"Web-Servers","Environment":"Dev","AppType":"Nginx"}},"variable_list":[]},{"description":"","action_list":[{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Category VM"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"e927d5df_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d5e14a9c_runbook","main_task_local_reference":{"kind":"app_task","name":"e927d5df_dag"},"variable_list":[]},"name":"pre_action_create"},{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Category VM"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ecfaed3c_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d3308d36_runbook","main_task_local_reference":{"kind":"app_task","name":"ecfaed3c_dag"},"variable_list":[]},"name":"post_action_delete"}],"type":"EXISTING_VM","name":"Category VM","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{ip_address}@@","delay_secs":"60","disable_readiness_probe":true},"os_type":"Linux","create_spec":{"type":"PROVISION_EXISTING_MACHINE","address":"0.0.0.0"},"variable_list":[]}],"credential_definition_list":[{"username":"admin","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"Prism Central User"},{"username":"nutanix","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"Nutanix"}],"package_definition_list":[{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"MongoDB"}],"name":"MongoDBPackage","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"MongoDBPackage"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"MongoDB Installation"},{"kind":"app_task","name":"MongoDB Load"}],"name":"a62ab18f_dag","state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"MongoDB Installation"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"MongoDB Load"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MongoDB"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"MongoDB Installation","state":"NOT_VALIDATED","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"5d61bb96_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MongoDB"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"MongoDB Load","state":"NOT_VALIDATED","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"ef6b3a3e_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"ebfc1042_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"a62ab18f_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"MongoDBPackage"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"6f5d9a5a_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d67184d7_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"6f5d9a5a_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"NodeJS"}],"name":"NodeJSPackage","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"NodeJSPackage"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"NodeJS Installation"},{"kind":"app_task","name":"Nodejs Mongo Install for Testing"}],"name":"8a5423be_dag","state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"NodeJS Installation"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Nodejs Mongo Install for Testing"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"NodeJS"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"NodeJS Installation","state":"NOT_VALIDATED","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"2462adfe_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"NodeJS"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Nodejs Mongo Install for Testing","state":"NOT_VALIDATED","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"301fcf68_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"e7bb43e7_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"8a5423be_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"NodeJSPackage"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"8f25d35a_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"a3c0d4f4_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"8f25d35a_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Nginx"}],"name":"NginxPackage","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"NginxPackage"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Nginx Installation"}],"name":"77c6710d_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Nginx"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Nginx Installation","state":"NOT_VALIDATED","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"ea95f24d_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"aa48ffba_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"77c6710d_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"NginxPackage"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"01e202b8_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"e47f81a1_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"01e202b8_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Flow"}],"name":"Category Package","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Category Package"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Create Category"},{"kind":"app_task","name":"Create Policy"}],"name":"c64ad0bd_dag","state":"NOT_VALIDATED","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Create Category"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Create Policy"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Flow"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Create Category","state":"NOT_VALIDATED","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"98251ac5_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Flow"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Create Policy","state":"NOT_VALIDATED","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"9d1d6d3d_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"1d2414e3_runbook","state":"NOT_VALIDATED","main_task_local_reference":{"kind":"app_task","name":"c64ad0bd_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Category Package"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Delete Policy"},{"kind":"app_task","name":"Delete Category"}],"name":"3405d0e0_dag","state":"NOT_VALIDATED","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Delete Policy"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Delete Category"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Flow"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Delete Policy","state":"NOT_VALIDATED","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"98251ac5_runbook_cloned_0_cloned_0"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Flow"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Delete Category","state":"NOT_VALIDATED","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"98251ac5_runbook_cloned_0"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"ca4f0169_runbook","state":"NOT_VALIDATED","main_task_local_reference":{"kind":"app_task","name":"3405d0e0_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"centos7_generic","version":"","options":{"type":"","name":"CENTOS-7.4","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-GenericCloud.qcow2","version":{"product_version":"","type":"","product_name":""},"architecture":"X86_64","type":""},"description":""},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"f8416720_deployment","min_replicas":"1","default_replicas":"","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"MongoDBPackage"}],"substrate_local_reference":{"kind":"app_substrate","name":"MongoDBVM"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"c4a7ebbf_deployment","min_replicas":"1","default_replicas":"","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"NodeJSPackage"}],"substrate_local_reference":{"kind":"app_substrate","name":"NodeJSVM"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"02eb0f42_deployment","min_replicas":"1","default_replicas":"","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"NginxPackage"}],"substrate_local_reference":{"kind":"app_substrate","name":"NginxVM"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"5854d6fd_deployment","min_replicas":"1","default_replicas":"","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Category Package"}],"substrate_local_reference":{"kind":"app_substrate","name":"Category VM"},"variable_list":[],"description":""}],"description":"","action_list":[],"name":"Default","variable_list":[{"val_type":"STRING","is_mandatory":true,"description":"This is the IP address of the JFrog Artifactory server that the build artifacts were pushed to.","data_type":"BASE","type":"LOCAL","name":"artifactory_ip","value":"10.59.115.125","label":"Artifactory IP Address","attrs":{"type":""},"editables":{"value":true},"is_hidden":false},{"val_type":"STRING","is_mandatory":true,"description":"The IP address of the Prism Central instance","data_type":"BASE","type":"LOCAL","name":"pc_instance_ip","value":"10.59.98.214","label":"Prism Central IP Address","attrs":{"type":""},"editables":{"value":true},"is_hidden":false},{"val_type":"STRING","is_mandatory":true,"description":"Name of the Git repository and corresponding Jenkins pipeline project to be created and connected.","data_type":"BASE","type":"LOCAL","name":"project_name","value":"devops","label":"Project Name","attrs":{"type":""},"editables":{"value":true},"is_hidden":false},{"val_type":"STRING","is_mandatory":true,"description":"The build number from the Jenkins build","data_type":"BASE","type":"LOCAL","name":"build_number","value":"1","label":"Build Number","attrs":{"type":""},"editables":{"value":true},"is_hidden":false},{"val_type":"STRING","is_mandatory":true,"description":"The public key that corresponds to the private key entered in the \"Nutanix\" credential.","data_type":"BASE","type":"SECRET","name":"nutanix_public_key","value":"","label":"Nutanix Public Key","attrs":{"is_secret_modified":false,"secret_reference":{},"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":true,"description":"Domain name used as suffix for FQDN. Entered similar to \"nutanix.lab\" or \"nutanix.com\".","data_type":"BASE","type":"LOCAL","name":"domain_name","value":"drm-poc.local","label":"Domain Name","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"Nutanix"},"type":"USER"},"name":"Application Deployment VMs"},"api_version":"3.0","metadata":{"last_update_time":"1570037730664815","kind":"blueprint","spec_version":17,"creation_time":"1569951938153449","name":"Application Deployment VMs"}}